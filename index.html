<!DOCTYPE html>
<html ng-app='blogApp'>
  <head>
    <meta charset='utf-8'>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" type="text/css" href="css/main.css" media="screen" />
    <body ng-controller='BlogCtrl'>
    Hello, Welcome!
    Kinka is back!
    中文
    <ul id='blog_list' ng-repeat='blog in blogs'>
        <li>{{blog.title}}</li>
    </ul>
    </body>

<script src='js/angular.js'></script>
<script src='js/firebase.js'></script>
<script src="js/firebase-simple-login.js"></script>
<script src="js/angularfire.min.js"></script>
<script type="text/javascript">
function $(id){
    return document.getElementById(id);
}

function Blog($q) {
    var ref = new Firebase('https://gh-brian.firebaseio.com');
    this._q = $q;
    this._ref = ref;
}
Blog.prototype = {
    getList: function() {
        var self = this;
        var deffered = self._q.defer();
        var gotList = function(snapshot){
            var value = snapshot.val();
            deffered.resolve(value);
        };        
        self._ref.child('blogs').on('value', gotList);
        return deffered.promise;
    }
}

var blogApp = angular.module('blogApp', ['firebase']);
blogApp.controller('BlogCtrl', function($scope, $q, $firebase) {
    var ref = new Firebase('https://gh-brian.firebaseio.com');
    $scope.blogs = $firebase(ref.child('blogs'));
    var titles = [];
    $scope.$watchCollection('blogs', function(newBlogs, oldBlogs) {
        for (var k in newBlogs) {
            if (angular.isString(k) && k.indexOf('$')<0) {
                titles.indexOf(k)<0 && titles.push(k);
            }
        }
        console.log(titles);
        });
});
</script>  
</html>
